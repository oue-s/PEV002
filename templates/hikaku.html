    <script>
        const selectableItems = document.getElementById('selectableItems');
        const selectedItems = document.getElementById('selectedItems');
        const selectedItemsInput = document.getElementById('selectedItemsInput');

        let draggingItem = null;

        // ドラッグ開始イベント
        document.querySelectorAll('.item').forEach(item => {
            item.addEventListener('dragstart', (e) => {
                draggingItem = e.target;
                e.dataTransfer.setData('text/plain', e.target.dataset.value);
                e.target.classList.add('dragging');
            });

            item.addEventListener('dragend', () => {
                draggingItem.classList.remove('dragging');
                draggingItem = null;
            });
        });

        // ドロップ可能エリアイベント
        [selectedItems].forEach(area => {
            area.addEventListener('dragover', (e) => {
                e.preventDefault();
                area.classList.add('drag-over');
            });

            area.addEventListener('dragleave', () => {
                area.classList.remove('drag-over');
            });

            area.addEventListener('drop', (e) => {
                e.preventDefault();
                area.classList.remove('drag-over');

                const value = e.dataTransfer.getData('text/plain');
                if (draggingItem && !selectedItems.contains(draggingItem)) {
                    // 削除ボタンを追加した複製を作成
                    const clonedItem = draggingItem.cloneNode(true);
                    clonedItem.querySelector('.remove-btn')?.remove();
                    clonedItem.innerHTML += `<button class="remove-btn">削除</button>`;

                    // 削除ボタンの動作を設定
                    clonedItem.querySelector('.remove-btn').addEventListener('click', () => {
                        selectedItems.removeChild(clonedItem);
                        updateHiddenInput();
                    });

                    selectedItems.appendChild(clonedItem);
                    updateHiddenInput();
                }
            });
        });

        // 隠しフィールド更新
        function updateHiddenInput() {
            const selectedValues = Array.from(selectedItems.children)
                .map(item => item.dataset.value)
                .filter(value => value);
            selectedItemsInput.value = JSON.stringify(selectedValues);
        }
    </script>
