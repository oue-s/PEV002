<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phoenix Eye Viewer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            margin: 10;
            padding: 0;
        }

        .container {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 900px;
            height: 100vh;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            overflow: hidden;
        }

        .list {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
            background-color: #f9f9f9;
            border-right: 1px solid #ccc;
        }

        .item-container {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 200px;
            padding: 2px;
            margin-right: 10px;
            background-color: #e0e0e0;
            border: 1px solid #ccc;
            border-radius: 5px;
            cursor: grab;
        }

        .item-text {
            margin-left: 10px;
            font-size: 11px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .remove-btn {
            margin-left: 2px;
            padding: 2px 5px;
            background-color: #ff4d4d;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        .remove-btn:hover {
            background-color: #ff1a1a;
        }

        input[type="text"] {
            margin-left: 10px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h2>項目選択</h2>
    <form action="/" method="POST" id="selectionForm">
        <button type="submit" style="margin-top: 20px;">決定</button>
        <br>
        <label for="numberInput">時間軸変換:</label>
        <select id="numberInput" name="number" required>
            <option value="0">無変換</option>
            <option value="1">起点を揃える</option>
            <option value="2">起点と終点を揃える</option>
            <option value="3">起点を揃え、任意の倍率</option>
            <option value="0">起点を指定する(未実装)</option>
            <option value="0">人→猫 変換(未実装)</option>
            <option value="0">対数変換(未実装)</option>
        </select>

        <div class="container">
            <div id="selectableItems" class="list">
                <h3>戦国武将特集</h3>
                <div class="item-container">
                    <div class="item" draggable="true" data-value="ieyasu">徳川家康の生涯</div>
                    <input type="text" class="item-text-box" placeholder="任意の文字列を入力">
                </div>
                <div class="item-container">
                    <div class="item" draggable="true" data-value="nobunaga">織田信長の生涯</div>
                    <input type="text" class="item-text-box" placeholder="任意の文字列を入力">
                </div>
                <!-- 他のアイテムも同様に追加 -->
            </div>

            <div id="selectedItems" class="list droppable">
                <div style="font-family: Arial, sans-serif; color: gray; font-size: 10px;">
                    表示したい歴史をココにドラッグ&ドロップしてください
                </div>
            </div>
        </div>

        <!-- 選択したアイテムのテキストと値を保持する隠しフィールド -->
        <input type="hidden" name="items" id="selectedItemsInput">
    </form>

    <script>
        const selectableItems = document.getElementById('selectableItems');
        const selectedItems = document.getElementById('selectedItems');
        const selectedItemsInput = document.getElementById('selectedItemsInput');

        let draggingItem = null;

        // ドラッグ開始イベント
        document.querySelectorAll('.item').forEach(item => {
            item.addEventListener('dragstart', (e) => {
                draggingItem = e.target;
                e.dataTransfer.setData('text/plain', e.target.dataset.value);
                e.target.classList.add('dragging');
            });

            item.addEventListener('dragend', () => {
                draggingItem.classList.remove('dragging');
                draggingItem = null;
            });
        });

        // ドロップ可能エリアイベント
        [selectedItems].forEach(area => {
            area.addEventListener('dragover', (e) => {
                e.preventDefault();
                area.classList.add('drag-over');
            });

            area.addEventListener('dragleave', () => {
                area.classList.remove('drag-over');
            });

            area.addEventListener('drop', (e) => {
                e.preventDefault();
                area.classList.remove('drag-over');

                const value = e.dataTransfer.getData('text/plain');
                const itemTextBox = draggingItem.querySelector('.item-text-box').value; // テキストボックスの値を取得

                if (draggingItem && !selectedItems.contains(draggingItem)) {
                    const clonedItem = draggingItem.cloneNode(true);
                    clonedItem.querySelector('.remove-btn')?.remove();
                    clonedItem.innerHTML += `<button class="remove-btn">削除</button>`;

                    clonedItem.querySelector('.remove-btn').addEventListener('click', () => {
                        selectedItems.removeChild(clonedItem);
                        updateHiddenInput();
                    });

                    selectedItems.appendChild(clonedItem);
                    updateHiddenInput();
                }
            });
        });

        // 隠しフィールド更新
        function updateHiddenInput() {
            const selectedValues = Array.from(selectedItems.children)
                .map(item => {
                    const textBoxValue = item.querySelector('.item-text-box').value; // テキストボックスの文字列を取得
                    const value = item.dataset.value;
                    return { value: value, text: textBoxValue };
                })
                .filter(value => value);
            selectedItemsInput.value = JSON.stringify(selectedValues);
        }
    </script>
</body>
</html>
